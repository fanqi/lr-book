<?xml version="1.0" encoding="UTF-8"?>
<custom-sql>
	<sql id="com.fingence.slayer.service.persistence.MyResultFinderImpl.findResults"> 
		<![CDATA[
			SELECT
				c.itemId,
				b.portfolioId,
				a.assetId,
				a.security_ticker, 
				a.id_isin,
				a.name,
				a.industry_sector,
				a.industry_group,
				a.industry_subgroup,
				a.current_price,
				c.purchasedFx,
				e.conversion as current_fx,
				b.baseCurrency,
				a.security_des,
				a.security_typ,
				a.security_typ2,
				a.parent_comp_name,
				c.purchaseQty,
				c.purchaseDate,
				a.security_class,
				a.country as countryId, 
				d.name as countryName, 
				a.country_of_risk as countryOfRisk,
				a.country_of_risk as countryOfRiskName,
				a.currency_,
				(c.purchasePrice * c.purchaseQty * c.purchasedFx) as purchasedMarketValue,
				(a.current_price * c.purchaseQty * e.conversion) as currentMarketValue,
				((a.current_price * c.purchaseQty * e.conversion) - (c.purchasePrice * c.purchaseQty * c.purchasedFx)) as gain_loss,
				((a.current_price * c.purchaseQty * e.conversion) - (c.purchasePrice * c.purchaseQty * c.purchasedFx))/(c.purchasePrice * c.purchaseQty * c.purchasedFx) * 100 as gain_loss_percent
			FROM 
				fing_Asset a,
				fing_Portfolio b,
				fing_PortfolioItem c,
				Country d,
				fing_CountryExt e
			WHERE 
				b.portfolioId = ?
				and a.assetId = c.assetId
				and b.portfolioId = c.portfolioId 
				and a.country = d.countryId
				and d.countryId = e.countryId
		]]>
	</sql>
</custom-sql>